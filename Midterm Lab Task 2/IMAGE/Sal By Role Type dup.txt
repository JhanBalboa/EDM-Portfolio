let
    Source = Csv.Document(File.Contents("D:\I101\MT2\Uncleaned_DS_jobs.csv"),[Delimiter=",", Columns=15, Encoding=1252, QuoteStyle=QuoteStyle.Csv]),
    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers",{{"index", Int64.Type}, {"Job Title", type text}, {"Salary Estimate", type text}, {"Job Description", type text}, {"Rating", type number}, {"Company Name", type text}, {"Location", type text}, {"Headquarters", type text}, {"Size", type text}, {"Founded", Int64.Type}, {"Type of ownership", type text}, {"Industry", type text}, {"Sector", type text}, {"Revenue", type text}, {"Competitors", type text}}),
    #"Extracted Text Before Delimiter" = Table.TransformColumns(#"Changed Type", {{"Salary Estimate", each Text.BeforeDelimiter(_, "("), type text}}),
    #"Inserted Text Between Delimiters" = Table.AddColumn(#"Extracted Text Before Delimiter", "Min Value", each Text.BetweenDelimiters([Salary Estimate], "$", "K"), type text),
    #"Inserted Text Between Delimiters1" = Table.AddColumn(#"Inserted Text Between Delimiters", "Text Between Delimiters", each Text.BetweenDelimiters([Salary Estimate], "$", "K", 1, 0), type text),
    #"Renamed Columns" = Table.RenameColumns(#"Inserted Text Between Delimiters1",{{"Text Between Delimiters", "Max Value"}}),
    #"Added Custom" = Table.AddColumn(#"Renamed Columns", "Role Type", each if Text.Contains([Job Title], "Data Scientist") then
"Data Scientist"
else if Text.Contains([Job Title], "Data Analyst") then
"Data Analyst"
else if Text.Contains([Job Title], "Data Engineer") then
"Data Engineer"
else if Text.Contains([Job Title], "Machine Learning") then
"Machine Learning Engineer"
else
"other"),
    #"Location Correction" = Table.AddColumn(#"Added Custom", "Location Correction", each if [Location]= "New Jersey" then ", NJ"
else if [Location] = "Remote" then ", other"
else if [Location]= "United States" then ", other"
else if [Location]= "Texas" then ", TX"
else if [Location]= "Patuxent" then ", MA"
else if [Location]= "California" then ", CA"
else if [Location]= "Utah" then ", UT"
else [Location]),
    #"Split Column by Delimiter" = Table.SplitColumn(#"Location Correction", "Location Correction", Splitter.SplitTextByDelimiter(",", QuoteStyle.Csv), {"Location Correction.1", "Location Correction.2"}),
    #"Location Correction 2" = Table.TransformColumnTypes(#"Split Column by Delimiter",{{"Location Correction.1", type text}, {"Location Correction.2", type text}}),
    #"Renamed Columns1" = Table.RenameColumns(#"Location Correction 2",{{"Location Correction.2", "Location Correction 2"}, {"Location Correction.1", "Location Correction 1"}}),
    #"Replaced Value" = Table.ReplaceValue(#"Renamed Columns1","Anne Arundel","MA",Replacer.ReplaceText,{"Location Correction 2"}),
    #"Replace Value Arundel" = Table.SelectRows(#"Replaced Value", each true),
    #"Split the size Column and create 2 new column" = Table.AddColumn(#"Replace Value Arundel", "Min Size", each Text.BeforeDelimiter([Size], " "), type text),
    #"Inserted Text Between Delimiters max" = Table.AddColumn(#"Split the size Column and create 2 new column", "Text Between Delimiters", each Text.BetweenDelimiters([Size], " ", " ", 1, 0), type text),
    #"Renamed Columns2" = Table.RenameColumns(#"Inserted Text Between Delimiters max",{{"Min Size", "MinCompanySize"}, {"Text Between Delimiters", "MaxCompanySize"}}),
    #"Filtered Rows" = Table.SelectRows(#"Renamed Columns2", each ([Competitors] <> "-1") and ([Industry] <> "-1")),
    #"Inserted Text Before Delimiter" = Table.AddColumn(#"Filtered Rows", "Text Before Delimiter", each Text.BeforeDelimiter([Company Name], "#(lf)"), type text),
    #"Renamed Columns3" = Table.RenameColumns(#"Inserted Text Before Delimiter",{{"Text Before Delimiter", "Company Nam (new)"}}),
    #"Remove Column Description" = Table.RemoveColumns(#"Renamed Columns3",{"Job Description"}),
    #"Reordered Columns" = Table.ReorderColumns(#"Remove Column Description",{"index", "Job Title", "Salary Estimate", "Rating", "Company Nam (new)", "Company Name", "Location", "Headquarters", "Size", "Founded", "Type of ownership", "Industry", "Sector", "Revenue", "Competitors", "Min Value", "Max Value", "Role Type", "Location Correction 1", "Location Correction 2", "MinCompanySize", "MaxCompanySize"}),
    #"Removed Columns" = Table.RemoveColumns(#"Reordered Columns",{"Company Name"}),
    #"Reordered Columns1" = Table.ReorderColumns(#"Removed Columns",{"index", "Job Title", "Role Type", "Salary Estimate", "Min Value", "Max Value", "Rating", "Company Nam (new)", "Location", "Location Correction 1", "Location Correction 2", "Headquarters", "Size", "MinCompanySize", "MaxCompanySize", "Founded", "Type of ownership", "Industry", "Sector", "Revenue", "Competitors"}),
    #"Removed Other Columns" = Table.SelectColumns(#"Reordered Columns1",{"Role Type", "Min Value", "Max Value"}),
    #"Renamed Columns4" = Table.RenameColumns(#"Removed Other Columns",{{"Min Value", "Min Sal"}, {"Max Value", "Max Sal"}}),
    #"Changed Type1" = Table.TransformColumnTypes(#"Renamed Columns4",{{"Min Sal", Currency.Type}, {"Max Sal", Currency.Type}}),
    #"Multiplied Column" = Table.TransformColumns(#"Changed Type1", {{"Min Sal", each _ * 1000, Currency.Type}}),
    #"Multiplied Column1" = Table.TransformColumns(#"Multiplied Column", {{"Max Sal", each _ * 1000, Currency.Type}}),
    #"Grouped Rows" = Table.Group(#"Multiplied Column1", {"Role Type"}, {{"Count", each Table.RowCount(_), Int64.Type}, {"Avg Min Sal", each List.Average([Min Sal]), type number}, {"Avg Max Sal", each List.Average([Max Sal]), type number}})
in
    #"Grouped Rows"